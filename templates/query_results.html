{% extends 'base.html' %}

{% block content %}

<br>
<h3>Query Key Word: "{{key_word}}" </h3>
{% if not query_results %}
	<h5>No Ted Talks Found. Return to Homepage to search again.</h5>
{% endif %}

{% for id, info in query_results %}
{% if id %}
	<table class="query-results">
		<tbody>
			<tr>
				<td><a href='/selection?key_word={{key_word}}&talk_id={{id}}&
					slug={{info[2]}}'>
					<img class="ted_talk_image" id="{{id}}">
					</a>
				</td>
			</tr>

			<tr>
				<td><a href='/selection?key_word={{key_word}}&talk_id={{id}}&
					slug={{info[2]}}'>{{id}}
					</a>
				</td>
			</tr>
			
			<tr>
				<td>{{info[0]}}</td>
			</tr>
			<tr>
				<td>{{info[1]}}</td>
			</tr>
		</tbody>
	</table>
{% endif %}
{% endfor %}


<script src="http://code.jquery.com/jquery.js"></script>
<script>
// fetch tedtalk images
	var ted_talk_image = $('.ted_talk_image')
	fetchImages = function(){
		var imageElement = $(this)
		console.log(imageElement)
		$.get('/get_images', {'talk_id': this.id}, function(data){
			imageElement.attr('src', data.image)

			}
		)
	}
	startImages = function(){
		for (var i=0; i<ted_talk_image.length; i++){
			$(ted_talk_image[i]).each(fetchImages);
		}
	}

	$(document).ready(startImages);


</script>

{% endblock %}


